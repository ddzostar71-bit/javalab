name: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  test:
    name: –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
    runs-on: ubuntu-latest

    steps:
    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v4

    - name: ‚òï –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Java JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven

    - name: üóÑÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MySQL
      run: |
        sudo systemctl start mysql.service
        mysql -e "SELECT VERSION();" -uroot -proot

    - name: üìä –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      run: |
        mysql -uroot -proot < src/main/resources/init.sql
        echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
        mysql -uroot -proot -e "USE travel_db; SELECT COUNT(*) as '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É—Ä–∏—Å—Ç–æ–≤' FROM tourists;"

    - name: ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
      run: |
        sed -i 's/db.password=root/db.password=root/g' src/main/resources/database.properties
        echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞"

    - name: üî® –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å Maven
      run: |
        mvn clean compile
        echo "‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!"

    - name: üöÄ –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞
      run: |
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤—ã–≤–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—É–±–∏—Ä–∞–µ–º Maven –ª–æ–≥–∏)
        mvn exec:java -Dexec.mainClass="by.bsuir.travel.Main" 2>&1 | \
        grep -v "^\[INFO\]" | \
        grep -v "^\[WARNING\]" | \
        grep -v "^Download" | \
        grep -v "^Progress" | \
        sed '/^$/N;/^\n$/D' > clean_output.txt

        echo "‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –≤—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω"

    - name: üìã –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
      run: |
        cat > –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt << 'EOF'
        ================================================================================
                          –û–¢–ß–ï–¢ –û –í–´–ü–û–õ–ù–ï–ù–ò–ò –ö–û–ù–¢–†–û–õ–¨–ù–û–ô –†–ê–ë–û–¢–´
                                      –í–ê–†–ò–ê–ù–¢ 5
        ================================================================================

        –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–ß–∞—Å—Ç—å 2)
        –¢–µ–º–∞: –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: EOF
        date '+%d.%m.%Y %H:%M:%S' >> –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt
        cat >> –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt << 'EOF'

        ================================================================================
                                  –ó–ê–î–ê–ù–ò–ï –í–ê–†–ò–ê–ù–¢–ê 5
        ================================================================================

        –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω DAO (Data Access Object) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏
        —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º JDBC –∏ MySQL.

        –¢–†–ï–ë–£–ï–ú–´–ï –ú–ï–¢–û–î–´:

        1. Travel findEntityById(int id)
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–æ–∏—Å–∫ —Ç—É—Ä–∏—Å—Ç–∞ –≤ –ë–î –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É
           ‚ûú –ü–∞—Ä–∞–º–µ—Ç—Ä: id - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—É—Ä–∏—Å—Ç–∞
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –æ–±—ä–µ–∫—Ç Travel –∏–ª–∏ null

        2. List<Travel> findAll()
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ Travel

        3. boolean delete(int id)
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—É—Ä–∏—Å—Ç–∞ –∏–∑ –ë–î –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É
           ‚ûú –ü–∞—Ä–∞–º–µ—Ç—Ä: id - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—É—Ä–∏—Å—Ç–∞
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: true –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –∏–Ω–∞—á–µ false

        4. boolean delete(Travel tourist)
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω–∏–µ —Ç—É—Ä–∏—Å—Ç–∞ –∏–∑ –ë–î –ø–æ –æ–±—ä–µ–∫—Ç—É
           ‚ûú –ü–∞—Ä–∞–º–µ—Ç—Ä: tourist - –æ–±—ä–µ–∫—Ç —Ç—É—Ä–∏—Å—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: true –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –∏–Ω–∞—á–µ false

        5. boolean create(Travel tourist)
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∏—Å—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
           ‚ûú –ü–∞—Ä–∞–º–µ—Ç—Ä: tourist - –æ–±—ä–µ–∫—Ç –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–∏—Å—Ç–∞
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: true –µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –∏–Ω–∞—á–µ false

        6. Travel update(Travel tourist)
           ‚ûú –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç—É—Ä–∏—Å—Ç–∞
           ‚ûú –ü–∞—Ä–∞–º–µ—Ç—Ä: tourist - –æ–±—ä–µ–∫—Ç —Ç—É—Ä–∏—Å—Ç–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
           ‚ûú –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç Travel –∏–ª–∏ null

        ================================================================================
                              –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –†–ê–ë–û–¢–´ –ü–†–û–ì–†–ê–ú–ú–´
        ================================================================================

        EOF
        cat clean_output.txt >> –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt
        cat >> –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt << 'EOF'

        ================================================================================
                                    –†–ï–ó–£–õ–¨–¢–ê–¢–´ –í–´–ü–û–õ–ù–ï–ù–ò–Ø
        ================================================================================

        ‚úÖ –í—Å–µ 6 –º–µ—Ç–æ–¥–æ–≤ TravelDAO —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
        ‚úÖ –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö MySQL
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PreparedStatement –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
        ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω DAO –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î
        ‚úÖ –í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è (try-with-resources)

        ================================================================================
                                         –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï
        ================================================================================

        –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É 5 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ.
        –í—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.
        –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é.

        –°—Ç—É–¥–µ–Ω—Ç: –ë–ì–£–ò–†
        –ì—Ä—É–ø–ø–∞: [—É–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –≥—Ä—É–ø–ø—É]

        ================================================================================
        EOF

        echo ""
        echo "‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt"
        echo ""

    - name: üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–∞ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
      uses: actions/upload-artifact@v4
      with:
        name: –û—Ç—á–µ—Ç-–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è-–†–∞–±–æ—Ç–∞-–í–∞—Ä–∏–∞–Ω—Ç-5-${{ github.run_number }}
        path: |
          –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt
          clean_output.txt
        retention-days: 90

    - name: üìä –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∏—Ç–æ–≥–æ–≤
      run: |
        echo ""
        echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo "‚ïë           –ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø –†–ê–ë–û–¢–ê - –í–ê–†–ò–ê–ù–¢ 5              ‚ïë"
        echo "‚ïë     –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ - –£–°–ü–ï–®–ù–û –í–´–ü–û–õ–ù–ï–ù–û!      ‚ïë"
        echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo ""
        echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:"
        mysql -uroot -proot -e "USE travel_db;
        SELECT '–í—Å–µ–≥–æ —Ç—É—Ä–∏—Å—Ç–æ–≤:' as '–ü–∞—Ä–∞–º–µ—Ç—Ä', COUNT(*) as '–ó–Ω–∞—á–µ–Ω–∏–µ' FROM tourists
        UNION ALL
        SELECT '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ç—É—Ä–∞:', ROUND(AVG(price), 2) FROM tourists
        UNION ALL
        SELECT '–°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:', ROUND(AVG(duration_days), 1) FROM tourists;"
        echo ""
        echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
        echo "üìÑ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: –û–¢–ß–ï–¢_–ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø_–†–ê–ë–û–¢–ê.txt"
        echo "üì¶ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è"
        echo ""
        echo "üí° –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞:"
        echo "   1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É 'Actions' –≤ GitHub"
        echo "   2. –ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫ workflow"
        echo "   3. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç '–û—Ç—á–µ—Ç-–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è-–†–∞–±–æ—Ç–∞-–í–∞—Ä–∏–∞–Ω—Ç-5-...' "
        echo ""
